---
title: "STA 325 Case Study"
authors: "Grady P., Laura C., Abby L., Ava E., & Ella T."
output: html_document
---

# Loading the packages and data

```{r}
## Loading the libraries 
library(tidyverse)
library(dplyr)
library(ggplot2)
# install.packages(moments)
library(moments)

## Loading the data
data_csv <- read.csv("Data/data-train.csv")
```

# Convert to central moments

```{r}
# convert raw moments to central moments
library(moments)

# raw moments from training data
m1 <- data_csv$R_moment_1   
m2 <- data_csv$R_moment_2
m3 <- data_csv$R_moment_3
m4 <- data_csv$R_moment_4

# raw moments starting at 0
raw_mat0 <- cbind(m0 = 1, m1 = m1, m2 = m2, m3 = m3, m4 = m4)

# raw to central
central_all <- t(apply(raw_mat0, 1, raw2central))

output <- data.frame(
  mean        = m1, # mean- first raw moment
  mu2_central = central_all[, 3], # sd 
  mu3_central = central_all[, 4], # skew
  mu4_central = central_all[, 5] # kurtosis
)

# Converting the central moments to statistics by dividing by sd
output$sd <- sqrt(output$mu2_central) # sd= sqrt(2nd central moment)
output$skewness <- output$mu3_central / (output$sd^3) # 3rd cm / sd^3
output$kurtosis <- output$mu4_central / (output$sd^4) #4th cm/ sd^4

central_moments_combined <- cbind(data_csv, output)
```

# Transform Predictors

```{r}
# Final dataframe with transformed predictors as well
data <- central_moments_combined |>
  mutate(log_St = log(St), 
         log_Re = log(Re),
         St_2 = St**2,
         Re_2 = Re**2,
         Fr_2 = Fr**2,
         St_sqrt = sqrt(St),
         Re_sqrt = sqrt(Re),
         logistic_Fr = 1/(1+exp(-Fr)) # using logitistic transformation for inf
         )
```

## Distribution of St, Re, Fr

### St: size of particles

```{r}
# Histogram for the different input variables

# no transformations
ggplot(data, aes(x = St)) +
  geom_histogram(binwidth = 0.1, fill = "skyblue", color = "black") +
  labs(title = "Histogram of St", x = "St", y = "Count")

# log transformed
ggplot(data, aes(x = log_St)) +
  geom_histogram(bins = 30, fill = "purple", color = "black") +
  labs(title = "Histogram of log(St)", x = "log(St)", y = "Count")

# squared transformed
ggplot(data, aes(x = St_2)) +
  geom_histogram(bins = 30, fill = "pink", color = "black") +
  labs(title = "Histogram of St^2", x = "St^2", y = "Count")

# square root transformed
ggplot(data, aes(x = St_sqrt)) +
  geom_histogram(bins = 30, fill = "blue", color = "black") +
  labs(title = "Histogram of sqrt(St)", x = "sqrt(St)", y = "Count")

```

Square root and log transformations have the most symmetric distributions. Square root is preferred since the range of St values is positive, so square root transformation will preserve the sign.

### Re: intensity of the turbulence within the flow

```{r}
# Histogram for the different input variables

# no transformations
ggplot(data, aes(x = Re)) +
  geom_histogram(fill = "skyblue", color = "black") +
  labs(title = "Histogram of Re", x = "Re", y = "Count")

# log tranformed
ggplot(data, aes(x = log_Re)) +
  geom_histogram(bins = 30, fill = "purple", color = "black") +
  labs(title = "Histogram of log(Re)", x = "log(Re)", y = "Count")

# squared transformed
ggplot(data, aes(x = Re_2)) +
  geom_histogram(bins = 30, fill = "pink", color = "black") +
  labs(title = "Histogram of Re^2", x = "Re^2", y = "Count")

# square root transformed
ggplot(data, aes(x = Re_sqrt)) +
  geom_histogram(bins = 30, fill = "blue", color = "black") +
  labs(title = "Histogram of sqrt(Re)", x = "sqrt(Re)", y = "Count")

# Finding the unique values of Re
unique(data$Re)
table(data$Re)
```

Notice Re only has 3 possible values: 90, 224, 398. This likely means that there are three main types of clouds so it might be advantageous to try use a categorical variable at points for interpretability. The distributions across all transformations are fairly similar since there are only three distinct Re values.

### Fr: degree of gravitation acceleration experienced by the flow

Note: This variable has infinite values

```{r}
# Histogram for the different input variables

# no transformations
ggplot(data, aes(x = Fr)) +
  geom_histogram(fill = "skyblue", color = "black") +
  labs(title = "Histogram of Fr", x = "Fr", y = "Count")

# logistic transformation
ggplot(data, aes(x = logistic_Fr)) +
  geom_histogram(bins = 30, fill = "green", color = "black") +
  labs(title = "Histogram of logistic of Fr", x = "Transformed Fr", y = "Count")

# Finding the unique values of Re
table(data$Fr)


```

Similarly to Re above, Fr only has three possible values: 0.052, 0.300, and Inf. The distribution of these variables is fairly even with 0.052 being the most common value and 0.3 being the least common value. We decided to use the logit transformation for Fr so that the values are bound between 0 and 1 which will handle the problem with the infinite values.

## Key Takeaways

-   St: log(St) and sqrt(St) both have more symmetric distributions - prefer sqrt(St) since all transformed values are still positive

-   Re: Could be treated categorically since there are only 3 unique cloud types. None of the transformations greatly changed the distribution of the variable since there are only 3 unique types so continue investigating the impact of different transformations in the models.

-   Fr: Use logistic transformation of the variable to ensure all values are bound between 0 and 1 to address the infinite values. Also explore treating Fr as categorical since there are 3 unique values.
