---
title: "STA 325 Case Study"
authors: "Grady P., Laura C., Abby L., Ava E., & Ella T."
output: html_document
---

# Loading the packages and data

```{r}
## Loading the libraries 
library(tidyverse)
library(dplyr)
library(ggplot2)
# install.packages(moments)
library(moments)

## Loading the data
data_csv <- read.csv("Data/data-train.csv")
```

# Convert to central moments
```{r}
# convert raw moments to central moments
library(moments)

# raw moments from training data
m1 <- data_csv$R_moment_1   
m2 <- data_csv$R_moment_2
m3 <- data_csv$R_moment_3
m4 <- data_csv$R_moment_4

# raw moments starting at 0
raw_mat0 <- cbind(m0 = 1, m1 = m1, m2 = m2, m3 = m3, m4 = m4)

# raw to central
central_all <- t(apply(raw_mat0, 1, raw2central))

output <- data.frame(
  mean        = m1, # mean- first raw moment
  mu2_central = central_all[, 3], # sd 
  mu3_central = central_all[, 4],
  mu4_central = central_all[, 5]
)

output$sd <- sqrt(output$mu2_central) # sd= sqrt(2nd central moment)
output$skewness <- output$mu3_central / (output$sd^3) # 3rd cm / sd^3
output$kurtosis <- output$mu4_central / (output$sd^4) #4th cm/ sd^4

central_moments_combined <- cbind(data, output)
```

#Transform Predictors
```{r}
data <- central_moments_combined |>
  mutate(log_St = log(St), 
         log_Re = log(Re),
         St_2 = St**2,
         Re_2 = Re**2,
         Fr_2 = Fr**2,
         St_sqrt = sqrt(St),
         Re_sqrt = sqrt(Re),
         logistic_Fr = 1/(1+exp(-Fr))
         )
```


## Distribution of St, Re, Fr

### St: size of particles

```{r}
# Histogram for the different input variables

# no transformations
ggplot(data, aes(x = St)) +
  geom_histogram(binwidth = 0.1, fill = "skyblue", color = "black") +
  labs(title = "Histogram of St", x = "St", y = "Count")

# log transformed
ggplot(data, aes(x = log_St)) +
  geom_histogram(bins = 30, fill = "purple", color = "black") +
  labs(title = "Histogram of log(St)", x = "log(St)", y = "Count")

# squared transformed
ggplot(data, aes(x = St_2)) +
  geom_histogram(bins = 30, fill = "pink", color = "black") +
  labs(title = "Histogram of St^2", x = "St^2", y = "Count")

ggplot(data, aes(x = St_sqrt)) +
  geom_histogram(bins = 30, fill = "blue", color = "black") +
  labs(title = "Histogram of sqrt(St)", x = "log(St)", y = "Count")

```


```{r}
# Finding whether there are any outliers
quartiles_st <- quantile(data$St, probs = c(0.25, 0.5, 0.75))
IQR_value_st <- (quartiles_st[[3]] - quartiles_st[[1]]) * 1.5

# Outliers would be above or below
lower_bound_st <- quartiles_st[[1]] - IQR_value_st
upper_bound_st <- quartiles_st[[3]] + IQR_value_st
print(lower_bound_st)
print(upper_bound_st)
```

Notice: St is right skewed with several outliers above the 2.05 range. It might be worth further exploring transforming this variable.

### Re: intensity of the turbulence within the flow

```{r}
# Histogram for the different input variables

ggplot(data, aes(x = Re)) +
  geom_histogram(fill = "skyblue", color = "black") +
  labs(title = "Histogram of Re", x = "Re", y = "Count")

ggplot(data, aes(x = log_Re)) +
  geom_histogram(bins = 30, fill = "purple", color = "black") +
  labs(title = "Histogram of log(Re)", x = "log(Re)", y = "Count")

ggplot(data, aes(x = Re_2)) +
  geom_histogram(bins = 30, fill = "pink", color = "black") +
  labs(title = "Histogram of Re^2", x = "Re^2", y = "Count")

ggplot(data, aes(x = Re_sqrt)) +
  geom_histogram(bins = 30, fill = "blue", color = "black") +
  labs(title = "Histogram of sqrt(Re)", x = "log(Re)", y = "Count")

# Finding the unique values of Re
unique(data$Re)
table(data$Re)
```


It is interesting that Re only has 3 possible values: 90, 224, 398. This likely means that there are three main types of clouds so it might be advantageous to try and determine which clouds are which. It appears as though 398 is the least frequent Re value while 224 is the most frequent.

### Fr: degree of gravitation acceleration experienced by the flow

Note: This variable has infinite values

```{r}
# Histogram for the different input variables

ggplot(data, aes(x = Fr)) +
  geom_histogram(fill = "skyblue", color = "black") +
  labs(title = "Histogram of Fr", x = "Fr", y = "Count")

ggplot(data, aes(x = logistic_Fr)) +
  geom_histogram(bins = 30, fill = "green", color = "black") +
  labs(title = "Histogram of logistic of Fr", x = "Transformed Fr", y = "Count")

# Finding the unique values of Re
table(data$Fr)


```
Similarily to Re above, Fr only has three possible values: 0.052, 0.300, and Inf. The distribution of these variables is fairly even with 0.052 being the most common value and 0.3 being the least common value. We are going to have to determine how we want to handle infinite Fr values.

From class, we know that lower hanging clouds have a higher Fr value so we could assume that those with infinite Fr are likely to be lower hanging.

**QUESTION**: Should 0.3 or Infinity be treated as a higher Fr value for lower hanging clouds?

**QUESTION:** What does an infinite Fr value mean? What is causing them?

-   Given the magnitude of the other values for Fr, I would assume they are being caused by a division by 0 error.

-   Froud Number = V / sqrt(gL) so likely g or L is negative where g is acceleration due to gravity and L is characteristic length of the flow. (g is likely 0)
